<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>War Thunder API</title>
    <link
      rel="shortcut icon"
      href="https://media.printables.com/media/prints/852559/images/6557322_27c4a7b3-e480-40d4-9b62-10c9f5570d24_7d21314a-1720-45d8-ba5a-77c27f44d9fe/thumbs/inside/1280x960/png/wt1.webp"
      type="image/x-icon"
    />
    <link rel="stylesheet" href="/style.css" />
  </head>

  <body>
    <nav>
      <div>
        <img
          src="https://media.printables.com/media/prints/852559/images/6557322_27c4a7b3-e480-40d4-9b62-10c9f5570d24_7d21314a-1720-45d8-ba5a-77c27f44d9fe/thumbs/inside/1280x960/png/wt1.webp"
          alt="War Thunder Logo"
          onclick="window.location.href='/'"
        />
      </div>
      <div>
        <a href="/">Home</a>
        <button class="theme-toggle" id="themeToggle">üåô</button>
      </div>
    </nav>

    <div class="banner">
      <h1>The War Thunder API</h1>
      <p>Serving less than 1 call each month!</p>
    </div>

    <main>
      <div class="links">
        <h2>Try it now!</h2>
        <form class="api-input-container" id="apiForm">
          <span class="api-base">http://localhost:5000/api/</span>
          <input
            class="api-path-input"
            id="apiPath"
            type="text"
            value="vehicles/aviation/aircraft/usa/p-26a-34m2"
          />
          <button class="api-submit-btn" type="submit">Submit</button>
        </form>
        <div class="data-display" id="dataDisplay"></div>
      </div>

      <div class="info">
        <h2>About This API</h2>
        <p>
          This RESTful API provides structured and categorized data for War
          Thunder aircraft, vehicles, and nations. It‚Äôs designed for simplicity
          and open access ‚Äî whether you‚Äôre building tools, dashboards, or just
          exploring the game‚Äôs tech tree.
        </p>

        <h3>Common API Calls</h3>
        <ul>
          <li>
            <code>api</code><br />
            Get all details about the API itself, including version, author, and available endpoints.
            <br />
          </li>
          <li>
            <code>vehicles/aviation</code><br />
            Returns a list of all aircraft entries grouped by nation.
            <br /><small>Example:</small>
            <code>http://localhost:5000/api/vehicles/aviation</code>
          </li>

          <li>
            <code>vehicles/aviation/aircraft/:nation</code><br />
            Fetch all aircraft from a specific nation (e.g. <code>usa</code>,
            <code>germany</code>, <code>japan</code>). <br /><small
              >Example:</small
            >
            <code
              >http://localhost:5000/api/vehicles/aviation/aircraft/usa</code
            >
          </li>

          <li>
            <code>vehicles/aviation/aircraft/:nation/:aircraftid</code><br />
            Get details about a specific aircraft, including stats like rank,
            BR, weight, speed limits, and crew.
            <br /><small>Example:</small>
            <code
              >http://localhost:5000/api/vehicles/aviation/aircraft/usa/p-26a-34m2</code
            >
          </li>

          <li>
            <code>nations</code><br />
            Lists all playable and non-playable nations represented in the
            database.
            <br /><small>Example:</small>
            <code>http://localhost:5000/api/nations</code>
          </li>
        </ul>

        <h3>Response Format</h3>
        <p>
          All data is returned in structured JSON with keys like
          <code>name</code>, <code>type</code>, <code>rank</code>, and nested
          objects for ratings and limits.
        </p>
        <pre><code>{
          "name": "P-26A-34M2",
          "nation": "usa",
          "type": "fighter",
          "rank": 1,
          "ratings": {
            "ab_rating": 1.0,
            "rb_rating": 1.0,
            "sb_rating": 1.0
          }
        }</code></pre>

        <p>
          Try the example endpoints above in the search box ‚Äî results will
          appear with syntax highlighting and collapsible sections for easy
          exploration.
        </p>
      </div>
    </main>

    <div class="footer">
      <p>
        Created by Maanvik Poddar ‚Äî War Thunder &copy; Gaijin Entertainment.
      </p>
    </div>

    <script>
      const form = document.getElementById("apiForm");
      const apiPathInput = document.getElementById("apiPath");
      const dataDisplay = document.getElementById("dataDisplay");
      const themeToggle = document.getElementById("themeToggle");

      // Dark mode toggle
      themeToggle.addEventListener("click", () => {
        document.body.classList.toggle("dark");
        themeToggle.textContent = document.body.classList.contains("dark")
          ? "‚òÄÔ∏è"
          : "üåô";
      });

      // Recursive JSON renderer with expand/collapse
      function renderJSON(obj, depth = 0) {
        if (typeof obj !== "object" || obj === null)
          return `<span class="${getTypeClass(obj)}">${formatValue(
            obj
          )}</span>`;

        const isArray = Array.isArray(obj);
        const entries = Object.entries(obj);
        const open = isArray ? "[" : "{";
        const close = isArray ? "]" : "}";

        let html = `<div class="json-block"><span class="toggle">‚ñ∂</span>${open}<div class="children" style="margin-left:${
          depth * 20
        }px;">`;

        for (let [key, value] of entries) {
          html += `<div><span class="json-key">"${
            isArray ? "" : key + '": '
          }</span>${renderJSON(value, depth + 1)}</div>`;
        }

        html += `</div>${close}</div>`;
        return html;
      }

      function getTypeClass(value) {
        if (typeof value === "string") return "json-string";
        if (typeof value === "number") return "json-number";
        if (typeof value === "boolean") return "json-boolean";
        if (value === null) return "json-null";
        return "";
      }

      function formatValue(value) {
        return typeof value === "string"
          ? `"${value}"`
          : value === null
          ? "null"
          : value;
      }

      function enableToggles() {
        document.querySelectorAll(".toggle").forEach((btn) => {
          btn.addEventListener("click", () => {
            const parent = btn.parentElement;
            parent.classList.toggle("collapsed");
            btn.textContent = parent.classList.contains("collapsed")
              ? "‚ñ∂"
              : "‚ñº";
          });
        });
      }

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        const fullURL = `http://localhost:5000/api/${apiPathInput.value.trim()}`;
        dataDisplay.innerHTML = `<p class="loading">Loading...</p>`;
        try {
          const res = await fetch(fullURL);
          if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);
          const json = await res.json();
          dataDisplay.innerHTML = renderJSON(json);
          enableToggles();
        } catch (err) {
          dataDisplay.innerHTML = `<p style="color:red;">${err.message}</p>`;
        }
      });
    </script>
  </body>
</html>
